<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/gold-email-input/gold-email-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<link rel="import" href="input-guest-list.html">
<link rel="import" href="input-location.html">

<dom-module id="event-create">
  <template>
    <style>
    </style>
    <paper-progress id="progress" value="0" secondary-progress="1" max="8"
      style="width: 400px;"></paper-progress>
    <form id="createEvent" is="iron-form" style="width: 400px;">
      <paper-input
        autofocus
        error-message="The event needs a name!"
        label="Name of the event (required)"
        name="name"
        required></paper-input>
      <paper-input-container>
        <label>Type of the event (optional)</label>
        <input
          is="iron-input"
          list="list"
          name="type"></input>
        <datalist id="list">
          <option value='Birthday Party'></option>
          <option value='Conference Talk'></option>
          <option value='Wedding'></option>
        </datalist>
      </paper-input-container>
      <paper-input
        label="Host (indivdual or organization) (optional)"
        name="host"
        value="[[profile.name]]"></paper-input>
      <paper-input-container always-float-label>
        <label>Start Date and Time (required)</label>
        <input
          error-message="What time should your guests showup?"
          is="iron-input"
          name="start"
          required
          type="datetime-local"></input>
      </paper-input-container>
      <paper-input-container always-float-label>
        <label>End Date and Time (optional)</label>
        <input
          is="iron-input"
          name="end"
          type="datetime-local"></input>
      </paper-input-container>
      <input-location
        label="Location (optional)"
        name="location"></input-location>
      <input-guest-list name="guests" required></input-guest-list>
      <paper-textarea
        label="Message (optional)"
        name="message"></paper-textarea>
      <paper-button on-click="onSubmit" raised>Create Event</paper-button>
    </form>
  </template>
  <script>
    Polymer({
      is: 'event-create',

      properties: {
        profile: Object
      },

      ready: function() {
        var form = this.$.createEvent;
        form.addEventListener('iron-form-presubmit', function(event) {
          event.preventDefault();

          var data = form.serialize();
          Object.keys(data).forEach(function(next, index, array) {
            console.log('next', next, data[next]);
            if (!data[next]) {
              delete data[next];
            }
          });

          this.fire('add-event', {
            form: data,
            callback: function(error) {
              console.log('error!', error);
            }
          })
        });
      },

      onSubmit: function() {
        console.log('onSubmit');
        this.$.createEvent.submit();
      }
    });
  </script>
</dom-module>