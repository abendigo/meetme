<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/gold-email-input/gold-email-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<link rel="import" href="input-guest-list.html">
<link rel="import" href="input-location.html">

<dom-module id="event-create">
  <template>
    <style>
    </style>
    <form id="createEvent" is="iron-form" style="width: 400px; margin: auto;">
      <paper-input
        autofocus
        error-message="The event needs a name!"
        id="name"
        label="Name of the event (required)"
        name="name"
        on-blur="_onBlurName"
        required></paper-input>
      <paper-input-container>
        <label for="type">Type of the event</label>
        <input
          is="iron-input"
          list="list"
          name="type"></input>
        <datalist id="list">
          <option value='Birthday Party'></option>
          <option value='Conference Talk'></option>
          <option value='Wedding'></option>
        </datalist>
      </paper-input-container>
      <paper-input
      error-message="Every event needs a host."
        id="host"
        label="Host (indivdual or organization) (required)"
        name="host"
        on-blur="_onBlurHost"
        required
        value="[[profile.name]]"></paper-input>
      <paper-input-container id="startcontainer" always-float-label attr-for-value="value">
        <label for="start">Start Date and Time (required)</label>
        <input
          error-message="startTimeError"
          id="start"
          is="iron-input"
          name="start"
          on-blur="_onBlurStart"
          required
          type="datetime-local"></input>
        <paper-input-error>Start Time Error</paper-input-error>
      </paper-input-container>
      <paper-input-container always-float-label>
        <label for="end">End Date and Time</label>
        <input
          id="end"
          is="iron-input"
          name="end"
          on-blur="_onBlurEnd"
          type="datetime-local"></input>
      </paper-input-container>
      <input-location
        label="Location"
        name="location"></input-location>
      <input-guest-list name="guests" required></input-guest-list>
      <paper-textarea
        label="Message"
        name="message"></paper-textarea>
      <paper-button on-click="onSubmit" raised>Create Event</paper-button>
    </form>
  </template>
  <script>
    Polymer({
      is: 'event-create',

      listeners: {
        'createEvent.iron-form-presubmit': '_presubmit'
      },

      properties: {
        callback: Function,
        profile: Object,
        startTimeErorr:String
      },

      // ready: function() {
      //   var form = this.$.createEvent;
      //   form.addEventListener('iron-form-presubmit', function(event) {
      //     event.preventDefault();
      //
      //     var data = form.serialize();
      //     Object.keys(data).forEach(function(next, index, array) {
      //       console.log('next', next, data[next]);
      //       if (!data[next]) {
      //         delete data[next];
      //       }
      //     });
      //
      //     this.fire('add-event', {
      //       form: data,
      //       callback: function(error) {
      //         console.log('error!', error);
      //       }
      //     })
      //   });
      // },
      _onBlurName: function(event) {
        if (!(event instanceof FocusEvent)) {
          this.$.name.validate();
          // this._valid.name = this.$.name.validate();
          // this.updateProgressBar();
        }
      },
      _onBlurHost: function(event) {
        if (!(event instanceof FocusEvent)) {
          this.$.host.validate();
        }
      },
      _onBlurStart: function(event) {
        this.startTimeError = 'start time error';
        this.$.start.invalid = true;

        console.log('container', this.$.startcontainer.value)
        this.$.startcontainer.invalid = true;

        var foo = this.$.start;
        console.log('blur start', foo, foo.value)
        if (!(event instanceof FocusEvent)) {
          this.$.start.validate();
        }
      },
      _onBlurEnd: function(event) {
      },

      onSubmit: function() {
        console.log('onSubmit');
        this.$.createEvent.submit();
      },
      _presubmit: function(event) {
        event.preventDefault();

        this.$.errormessage.innerHtml = "Processing...";

        var data = form.serialize();
        Object.keys(data).forEach(function(next, index, array) {
          console.log('next', next, data[next]);
          if (!data[next]) {
            delete data[next];
          }
        });


        this.callback(data)
        .then(function() {

        }, function(error) {

        });
      }
    });
  </script>
</dom-module>
